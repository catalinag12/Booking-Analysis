---
title: "Hotel Booking Analysis"
author: "Maftei Alexandru, Vasile Catalina"
output: slidy_presentation
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
```

### Introduction
The dataset contains information on bookings in two types of hotels, both located in Portugal,a resort hotel and a city hotel. Each observation represents a hotel reservation. The data set includes reservations between July 1, 2015 and August 31, 2017, including those canceled. Because it is the actual data of the hotel, all information regarding the identification of the hotel or the client has been deleted. Due to the lack of real business data for scientific and educational purposes, these data sets can play an important role for research and education in revenue management, machine learning or data mining, as well as in other fields.

Every year, more than 140 million bookings were made on the Internet and hotel booking cancellations is a growing problem. An analysis of the last 5 years showed that the cancellation rate on booking has reached almost 40% and this trend produces a very negative impact on hotels revenue and distribution management strategies.

So, it is useful to try to understand and even predict which guests are more likely to cancel their bookings by getting insights from the data set and discovering which features have contributed more to cancellations.



### The dataset
+ hotel : resort or city
+ is_canceled: canceled=1, not canceled=0
+ arrival_date_year
+ arrival_date_month
+ arrival_date_month : between 1 and 53
+ arrival_date_day_of_month
+ stays_in_weekend_nights
+ stays_in_week_nights
+ adults
+ children
+ babies
+ meal: undefined(no package), BB, HB, FB
+ country
+ market_segment : TA=travel agents, TO=tour operators
+ distribution_channel : TA or TO
+ is_repeated_guest: yes=1, no=0
+ previous_cancellations
+ previous_bookings_not_canceled
+ reserved_room_type
+ assigned_room_type
+ booking_changes
+ deposit_type: no deposit, non refund or refundable
+ agent
+ company
+ day_in_waiting_list
+ customer_type
+ adr (average daily rate) =sum of all transactions/no of nights
+ required_car_parking_spaces
+ total_of_special_requests
+ reservation_status: canceled, check-out, no-show
+ reservation_status_date

### Preparation of the data set
```{r}
data<-read.csv('C:/Users/catal/OneDrive/Desktop/hotel_bookings.csv', header= TRUE)
mydataset<-read.csv('C:/Users/catal/OneDrive/Desktop/hotel_bookings.csv', header= TRUE)
#delete missing values
sum(is.na(mydataset))
#4 missing values in the column childer, so we'll replace them with values from column babies
n <- length(mydataset$children)
for (i in 1:n) {
  if (is.na(mydataset$children[i]))
    mydataset$children[i] <- mydataset$babies[i]
}


#verify again if the missing values were omitted
sum(is.na(mydataset))

rownames(mydataset)<-mydataset$name
mydataset$name=NULL
str(mydataset)
```


### Exploratory Data Analysis
* perform initial investigations on data in order to discover patterns, anomalies with the help of summary statistics and graphical representations

We will try to answer to questions such as:

+ Which month is the most occupied?
+ Which month has the greates number of canceled bookings?
+ Which hotel has a greater number of cancelations?
+ Has the deposit type any effect on the cancelations?
+ From which country most tourists come?
+ Which is the most booked accommodation type?
+ How does the ADR vary over year?

We will also try to find different relationships between the attributes.

### Graphics

```{r}
countries<-as.data.frame(table(mydataset$country))
data <- data.frame(
  group=countries["Var1"],
  value=countries["Freq"]
)

install.packages("ggplot2",repos = "http://cran.us.r-project.org")
library(ggplot2)

ggplot(data, aes(x="", y=Freq, fill=Var1)) +
  geom_bar(stat="identity", width=1) +
  coord_polar("y", start=0)+ 
  geom_text(aes(y = Freq, label = Var1), color = "white") + 
  theme(legend.position="none")
```

People from almost the entire world choose to spend their holiday in these two hotels. The majority is of course, from Portugal, and also from european countries, such as Great Britain and France.



```{r}
ggplot(data = mydataset,aes(is_canceled))+ geom_histogram(binwidth = 0.5, col='black', fill='blue', alpha = 0.4) + facet_wrap(~hotel)
```

Most of the cancellations are made at city hotels.



```{r}

install.packages("dplyr",repos = "http://cran.us.r-project.org")   
library(magrittr)
library(dplyr)
mydataset%>%count(hotel)%>%ggplot(aes(hotel,n)) + geom_bar(stat = 'identity', fill = 'blue', alpha = 0.4, col = "black") +
  xlab('Hotels ') + ylab('Frequency')
```

However, clients still prefer city hotels instead of resorts.


```{r}
table(mydataset$hotel)


table(mydataset$is_canceled, mydataset$hotel)
```



```{r}
mydataset%>%group_by(arrival_date_month)%>%summarise(Count = n())%>%arrange(-Count)%>%ggplot(aes(x = arrival_date_month, y = Count)) +
  geom_bar(stat = 'identity',fill = "dodgerblue") + coord_flip() + geom_text(aes(x =arrival_date_month, y=0.02, label= Count),
                                                                             hjust=-1, vjust=0, size=4, 
                                                                             colour="black", fontface="bold",
                                                                             angle=360)
```

The most popular month is august, followed by july, and the least popular for travelling is january.

```{r}
mydataset %>% group_by(mydataset$arrival_date_month)  %>% summarise(length(is_canceled))
```

July and august are also the months with the greatest number of cancellations.

```{r}
mydataset %>% group_by(mydataset$adults)  %>% summarise(length(is_canceled))

```

Couples are more likey to cancel their bookings.

```{r}
ggplot(mydataset, aes(arrival_date_month, fill = factor(is_canceled))) +
  geom_bar() + geom_text(stat = "count", aes(label = ..count..), hjust = 1) +
  coord_flip() + scale_fill_discrete(
    name = "Statusul",
    breaks = c("0", "1"),
    label = c("Canceled", "Confirmed")
  ) +
  labs(title = "Status of the booking depending on month",
       x = "Month",
       y = "Number") + theme_bw()
```


 

```{r}
ggplot(mydataset, aes(customer_type, fill = hotel)) + 
  geom_bar(stat = "count", position = position_dodge()) + 
  labs(title = "Customer preferences",
       x = "Customer type",
       y = "Number") +
  theme(axis.text.x = element_text(angle = 90, hjust = 1),
        panel.background = element_blank())
```



```{r}
mydataset %>% group_by(mydataset$market_segment)  %>% summarise(length(is_canceled)) 
```
The online segment has the greatest number of cancellations.


```{r}

mydataset %>% group_by(mydataset$reserved_room_type)  %>% summarise(length(is_canceled)) 
```
Room of type A has the greatest number of cancellations.

